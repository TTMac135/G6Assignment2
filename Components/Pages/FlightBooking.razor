@page "/FlightFinder"
@using G6Assignment2.ProblemDomain


<h3>Flight Finder</h3>

<div class="page">
    <form class="form-group-finder">

        <div class="form-group">
            <label for="departureAirport">From:</label>
            <input id="departureAirport" type="text" @bind="origin"/>
        </div>

        <div class="form-group">
            <label for="arrivalAirport">To:</label>
            <input id="arrivalAirport" type="text" @bind="destination"/>
        </div>

        <div class="form-group">
            <label for="day">Day:</label>
            <input id="day" type="text" @bind="day"/>
        </div>

        <button type="button" @onclick="FindFlightsButton">Find Flights</button>
    </form>

 <h4>Flights</h4>

<div class="scrollable-list">
    <table>
        <tbody>
                @foreach (Flight flight in matchingFlights)
                {
                    string rowClass = "";
                    if (flight == selectedFlight)
                    {
                        rowClass = "selected-row";
                    }
                    <tr class="@rowClass" @onclick="() => SelectFlight(flight)">
                        <td>@flight.ToString()</td>
                    </tr>
                }
        </tbody>
    </table>
</div>

<h3>Reserve</h3>
    <form class="form-group-reserve">
        <label for="reserveFlightCode">Flight Code:</label>
        <input id="reserveFlightCode" type="text" @bind="reserveFlightCode" readonly/>

        <label for="reserveAirline">Airline:</label>
        <input id="reserveAirline" type="text" @bind="reserveAirline" readonly/>

        <label for="reserveDay">Day:</label>
        <input id="reserveDay" type="text" @bind="reserveDay" readonly/>

        <label for="reserveTime">Time:</label>
        <input id="reserveTime" type="text" @bind="reserveTime" readonly />

        <label for="reserveCost">Cost:</label>
        <input id="reserveCost" type="text" @bind="reserveCost" readonly />

        <label for="reserveName">Name:</label>
        <input id="reserveName" type="text" @bind="reserveName"/>

        <label for="reserveCitizenship">Citizenship:</label>
        <input id="reserveCitizenship" type="text" @bind="reserveCitizenship"/>

        <div class="button-container">
            <button type="button" @onclick="() => MakeReservation(selectedFlight, reserveName, reserveCitizenship)">Reserve</button>
        </div>
    </form>
</div>


<style>
    h3, h4 {
        text-align: center;
        margin-bottom: 20px;
        margin-top: 20px;
    }

    .page {
        width: 100%;
        height: 100%;
    }

    .form-group-finder {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .form-group-finder .form-group {
        width: 25%;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .form-group-finder button {
        width: 23%;
    }

    .form-group-finder input {
        width: 100%;
    }

    .form-group-reserve label, .form-group-reserve input {
        display: block;
        margin-bottom: 10px;
        width: 100%;
    }

    .button-container {
        text-align: center;
    }

    .scrollable-list {
        max-height: 300px;
        overflow-y: scroll;
        border: 1px solid black;
        padding: 15px;
    }

    button {
        border-radius: 4px;
        padding-left: 100px;
        padding-right: 100px;
        display: inline-block;
        background-color: blue;
        color: white;
    }

    .selected-row {
        background-color: lightblue;
    }
    
</style>

@code {
    private string origin;
    private string destination;
    private string day;
    private List<Flight> matchingFlights = new List<Flight>();
    private FlightFinder flightFinder = new FlightFinder();


    //Runs CreateFlights when page is loaded
    protected override void OnInitialized()
    {
        flightFinder.CreateFlights();
    }
    //Runs FindFlights when button is clicked
    private void FindFlightsButton()
    {

        string origFixed = origin;
        string destFixed = destination;
        string dayFixed = day;

        //Cleaning user input
        if (origin != null)
        {
            origFixed = origin.ToUpper();
        }
        if (destination != null)
        {
            destFixed = destination.ToUpper();
        }
        if (day != null)
        {
            dayFixed = char.ToUpper(day[0]) + day.Substring(1).ToLower();
        }
        matchingFlights = flightFinder.findFlights(origFixed, destFixed, dayFixed);
    }

    private Flight selectedFlight;
    private string reserveFlightCode;
    private string reserveAirline;
    private string reserveDay;
    private string reserveTime;
    private string reserveCost;
    private string reserveName;
    private string reserveCitizenship;

    // Selects a flight from the list
    private void SelectFlight(Flight flight)
    {
        selectedFlight = flight;
        reserveFlightCode = flight.FlightCode;
        reserveAirline = flight.Airline;
        reserveDay = flight.Day;
        reserveTime = flight.Time;
        reserveCost = flight.Cost.ToString();
    }

    private void MakeReservation(Flight selectedFlight, string reserveName, string reserveCitizenship)
    {
        // Check if a flight is selected and required fields are filled
        if (selectedFlight != null && reserveName != null && reserveCitizenship != null)
        {
            string reservationCode = GenerateReservationCode();
            
            // Create a new Reservation object
            Reservation reservation = new Reservation(
                reservationCode,
                selectedFlight.FlightCode,
                selectedFlight.Airline,
                selectedFlight.Day,
                selectedFlight.Time,
                selectedFlight.Seats,
                selectedFlight.Cost,
                reserveName,
                reserveCitizenship,
                true
            );
        }
    }

    private string GenerateReservationCode() // PLACEHOLDER
    {
        return ""; // PLACEHOLDER!!!!
    }
}
